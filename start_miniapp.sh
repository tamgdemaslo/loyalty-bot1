#!/bin/bash

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Telegram Mini App ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸..."
echo "=" * 50

# ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ð¼ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ miniapp
cd "$(dirname "$0")/miniapp"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ Ð»Ð¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
if [ ! -d "node_modules" ]; then
    echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
    npm install
fi

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ .env Ñ„Ð°Ð¹Ð» ÐµÑÐ»Ð¸ ÐµÐ³Ð¾ Ð½ÐµÑ‚
if [ ! -f ".env" ]; then
    echo "âš™ï¸ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸..."
    cat > .env << EOF
BOT_TOKEN=7914899311:AAGY4CjuMqZX3w1eS7zCM2yNMW3312xCwPE
PORT=3000
NODE_ENV=development
EOF
    echo "âœ… Ð¤Ð°Ð¹Ð» .env ÑÐ¾Ð·Ð´Ð°Ð½"
fi

echo ""
echo "ðŸŒŸ Mini App Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚:"
echo "   â€¢ Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð±Ð¾Ð½ÑƒÑÐ¾Ð² Ð¸ Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸"
echo "   â€¢ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð½Ð° Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ" 
echo "   â€¢ Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ð¾ÑÐµÑ‰ÐµÐ½Ð¸Ð¹ Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹"
echo "   â€¢ Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ"
echo "   â€¢ ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"
echo "   â€¢ ÐÐ´Ð°Ð¿Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð´Ð¸Ð·Ð°Ð¹Ð½ Ð´Ð»Ñ Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ñ…"
echo ""
echo "ðŸ“± Ð”Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² Telegram:"
echo "   1. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ngrok: npx ngrok http 3000"
echo "   2. Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ URL Ð² @BotFather"
echo "   3. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Web App Ñ‡ÐµÑ€ÐµÐ· /newapp"
echo ""
echo "ðŸŒ Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿: http://localhost:3000"
echo "â¹ï¸  Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"
echo "=" * 50

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐµÑ€Ð²ÐµÑ€
npm start
